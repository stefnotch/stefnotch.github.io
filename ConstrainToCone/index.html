<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Constraining to a cone* | Stefnotch's Bloggy Blog</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/web/Blog/assets/style.89b56c19.css">
    <link rel="modulepreload" href="/web/Blog/assets/app.c56f9413.js">
    <link rel="modulepreload" href="/web/Blog/assets/ConstrainToCone_index.md.81f2fe56.lean.js">
    
    <meta name="twitter:title" content="Constraining to a cone* | Stefnotch&#39;s Bloggy Blog">
  <meta property="og:title" content="Constraining to a cone* | Stefnotch&#39;s Bloggy Blog">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/web/Blog/" aria-label="Stefnotch&#39;s Bloggy Blog, back to home" data-v-675d8756 data-v-cc01ef16><!----> Stefnotch&#39;s Bloggy Blog</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/stefnotch/stefnotch.github.io" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub Repo <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/stefnotch/stefnotch.github.io" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub Repo <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#example-code">Example code</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="constraining-to-a-cone" tabindex="-1">Constraining to a cone*</h1><p>*with the least amount of trigonometry</p><p>TODO: If you specify a cone angle as a vector, you could get away with zero trig</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>=</mo><mtext>Vector to clamp (normalized)</mtext></mrow><annotation encoding="application/x-tex">v = \text{Vector to clamp (normalized)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Vector to clamp (normalized)</span></span></span></span></span><br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>=</mo><mtext>Clamping direction vector (normalized)</mtext></mrow><annotation encoding="application/x-tex">u = \text{Clamping direction vector (normalized)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Clamping direction vector (normalized)</span></span></span></span></span><br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mtext>Clamping angle</mtext></mrow><annotation encoding="application/x-tex">\alpha = \text{Clamping angle}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Clamping angle</span></span></span></span></span></p><p>Figure out what the cutoff dot product <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> is<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>d</mi><mi>o</mi><mi>t</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>u</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">acos(dot(v, u)) = \alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span><br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d = cos(\alpha)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mclose">)</span></span></span></span></p><p>Quick test<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>if</mtext><mo stretchy="false">(</mo><mi>d</mi><mi>o</mi><mi>t</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>u</mi><mo stretchy="false">)</mo><mo>&gt;</mo><mo>=</mo><mi>d</mi><mo stretchy="false">)</mo><mtext> return </mtext><mi>d</mi></mrow><annotation encoding="application/x-tex">\text{if}(dot(v,u) &gt;= d) \text{ return } d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">if</span></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mord text"><span class="mord"> return </span></span><span class="mord mathnormal">d</span></span></span></span></p><p>Otherwise, we gotta clamp our vector towards u.</p><p>As a first step, we&#39;ll clamp our vector towards 90 degree/pi.</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>−</mo><mi>u</mi><mo>∗</mo><mi>d</mi><mi>o</mi><mi>t</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>u</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">u - u * dot(v,u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span></span></span></span></p><p>Now we have a simple, specialized case that we can easily reason about. The next step would be to add something to the vector so that it&#39;s inside the cone again.</p><p>TODO: Normalize it, divide by g, add u * d</p><!----><h2 id="example-code" tabindex="-1">Example code</h2><div class="language-cs"><pre><code><span class="token comment">// Constrains a vector to a cone around some other vector</span>
<span class="token comment">// coneDirection should be normalized</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Vector3</span> <span class="token function">ConstrainToCone</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">Vector3</span> direction<span class="token punctuation">,</span> <span class="token keyword">ref</span> <span class="token class-name">Vector3</span> coneDirection<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> maxAngle<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>maxAngle <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> coneDirection <span class="token operator">*</span> direction<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>maxAngle <span class="token operator">&gt;=</span> Mathf<span class="token punctuation">.</span>Pi<span class="token punctuation">)</span> <span class="token keyword">return</span> direction<span class="token punctuation">;</span>

    <span class="token class-name">Vector3</span> unitDirection <span class="token operator">=</span> direction<span class="token punctuation">.</span>Normalized<span class="token punctuation">;</span> <span class="token comment">// normalizing can sometimes be avoided (just pass in a normalized direction)</span>

    <span class="token class-name"><span class="token keyword">float</span></span> cutoffDotProduct <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Cos</span><span class="token punctuation">(</span>maxAngle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// could be precomputed</span>
    <span class="token class-name"><span class="token keyword">float</span></span> coneRadius <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>maxAngle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// could be precomputed</span>

    <span class="token class-name"><span class="token keyword">float</span></span> vectorDotProduct <span class="token operator">=</span> Vector3<span class="token punctuation">.</span><span class="token function">Dot</span><span class="token punctuation">(</span><span class="token keyword">ref</span> unitDirection<span class="token punctuation">,</span> <span class="token keyword">ref</span> coneDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vectorDotProduct <span class="token operator">&gt;=</span> cutoffDotProduct<span class="token punctuation">)</span> <span class="token keyword">return</span> direction<span class="token punctuation">;</span>

    <span class="token comment">// Note: The case with the direction vector being the exact opposite of the coneDirection might need extra handling</span>
    <span class="token comment">// Hm, is this actually correct? (direction instead of unitDirection)</span>
    <span class="token class-name">Vector3</span> clampedToPie <span class="token operator">=</span> direction <span class="token operator">-</span> coneDirection <span class="token operator">*</span> vectorDotProduct<span class="token punctuation">;</span>
    clampedToPie<span class="token punctuation">.</span><span class="token function">Normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    clampedToPie <span class="token operator">/=</span> coneRadius<span class="token punctuation">;</span>

    <span class="token keyword">return</span> clampedToPie <span class="token operator">+</span> coneDirection <span class="token operator">*</span> cutoffDotProduct<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"constraintocone_index.md\":\"81f2fe56\",\"slidingpuzzle_index.md\":\"3eb58376\",\"index.md\":\"1248d6cd\"}")</script>
    <script type="module" async src="/web/Blog/assets/app.c56f9413.js"></script>
    
  </body>
</html>